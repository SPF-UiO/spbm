{% extends "base.jinja" %}
{% set title = _("Events") %}

{% from 'events/utils.jinja' import table_of_shifts %}

{% block toolbar %}
    <a class="btn btn-success {%- if not user.has_perm('society.add_event') %} disabled {%- endif %}"
       href="{{ url('event-add') }}">
        <span class="glyphicon glyphicon-asterisk"></span> {{ _("Add new event") }}
    </a>
{% endblock %}

{% block content -%}

    {%- for processed, events in events %}
        <h2>
            {%- if processed is none -%}
                {{ _("Not processed yet") }}
            {%- else -%}
                {{ _('Processed on %(date)s', date=processed | localize) }}
            {%- endif -%}
        </h2>
        <table class="table table-striped">
            <thead>
            <tr>
                <th>{{ _("Date") }}</th>
                <th>{{ _("Event") }}</th>
                <th>{{ _("Total hours") }}</th>
                <th>{{ _("Total cost") }}</th>
                <th>{{ _("Shift details") }}</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {%- for event in events %}
                <tr>
                    <td>{{ event.date | localize }}</td>
                    <td>{{ event.name }}</td>
                    <td>{{ _('%(hours)sh', hours=event.hours | intcomma) }}</td>
                    <td>{{ _('NOK %(cost)s', cost=event.cost | intcomma) }}</td>
                    <td>
                        <div class="event" style="padding-top: 10px">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th style="width: 20%;">{{ _("Name") }}</th>
                                    <th style="width: 10%">{{ _("Hourly") }}</th>
                                    <th style="width: 10%">{{ _("Hours") }}</th>
                                    <th style="width: 10%">{{ _("Sum") }}</th>
                                </thead>
                                <tbody>
                                {%- for shift in event.shifts.all() %}
                                    <tr>
                                        <td>{{ shift.worker.name }}</td>
                                        <td>{{ shift.wage | intcomma }}</td>
                                        <td>{{ shift.hours | intcomma }}</td>
                                        <td>{{ _('NOK %(cost)s', cost=shift.get_total() | intcomma) }}</td>
                                    </tr>
                                {%- endfor %}
                                </tbody>
                            </table>
                        </div>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{{ url('event-view', event.id) }}"
                               title="{{ _("View the details of the event") }}" class="btn btn-info">
                                <i class="glyphicon glyphicon-eye-open"></i>
                                <span class="sr-only">{{ _("View event") }}</span>
                            </a>
                            {% if user.has_perm('society.change_event') and event.processed is none -%}
                                <a href="{{ url('event-edit', event.id) }}"
                                   title="{{ _("Edit the event, such as date, workers, and more") }}"
                                   class="btn btn-warning">
                                    <i class="glyphicon glyphicon-pencil"></i>
                                    <span class="sr-only">{{ _("Edit event") }}</span>
                                </a>
                            {%- endif %}
                        </div>

                    </td>
                </tr>
                </a>
            {%- endfor %}
            </tbody>
        </table>
    {%- endfor %}
{% endblock %}
